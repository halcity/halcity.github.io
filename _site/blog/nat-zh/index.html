<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->

<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
       new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
       j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
       'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
       })(window,document,'script','dataLayer','GTM-WP54B9K');</script>
    <!-- End Google Tag Manager -->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>[译] NAT - 网络地址转换</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico" />

    <!-- Come and get me RSS readers -->
    <link rel="alternate" type="application/rss+xml" title="ArthurChiao's Blog" href="http://0.0.0.0:4000/feed.xml" />
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <!--[if IE 8]><link rel="stylesheet" href="/assets/css/ie.css"><![endif]-->
    <link rel="canonical" href="http://0.0.0.0:4000/blog/nat-zh/">

    <!-- Modernizr -->
    <script src="/assets/js/modernizr.custom.15390.js" type="text/javascript"></script>

    
</head>


<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WP54B9K"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

    <div class="header">
     <div class="container">
         <h1 class="logo"><a href="/">ArthurChiao's Blog</a></h1>
         <nav class="nav-collapse">
             <ul class="noList">
                 
                   
                   
                   <li class="element first  ">
                     <a href="/index.html">Home</a>
                   </li> 
                 
                   
                   
                   <li class="element   ">
                     <a href="/articles">Articles</a>
                   </li> 
                 
                   
                   
                   <li class="element   ">
                     <a href="/articles-zh">Articles (中文)</a>
                   </li> 
                 
                   
                   
                   <li class="element   ">
                     <a href="/categories">Categories</a>
                   </li> 
                 
                   
                   
                   <li class="element   last">
                     <a href="/about">About</a>
                   </li> 
                 
                 <!-- <li> <a href="https://github.com/arthurchiao/reading" target="_blank">Reading</a></li> -->
                 <!-- <li> <a href="https://github.com/arthurchiao/" target="_blank">GitHub</a></li> -->
             </ul>
         </nav>
     </div>
 </div><!-- end .header -->


   <div class="content">
      <div class="container">
         <div class="post">
  
  <h1 class="postTitle">[译] NAT - 网络地址转换</h1>
  <p class="meta">2019-02-17 | <span class="time">20</span> Minute Read</p>

  
  
  <h3 id="译者序">译者序</h3>

<p>本文翻译自2016年的一篇英文博客 <a href="https://www.karlrupp.net/en/computer/nat_tutorial">NAT - Network Address
Translation</a> 。</p>

<p><strong>由于译者水平有限，本文不免存在遗漏或错误之处。如有疑问，请查阅原文。</strong></p>

<p>以下是译文。</p>

<hr />

<h2 id="1-绪论">1 绪论</h2>

<p>网络地址转换通常涉及<strong>“在 IP 包经过路由器或防火墙的时候，修改其源和/或目的地址”</strong>（
<a href="http://en.wikipedia.org/wiki/Network_Address_Translation">Wikipedia: NAT</a>）。</p>

<p>本文将介绍什么是 NAT、如何使用 NAT 以及在 Linux （或者更广泛地说，各种 Unix 的衍生版） 上如何配置 NAT。
但是，本文不会覆盖 NAT 的所有细节，而主要想让读者知道：
在现代计算机网络中它可以用来做什么，及其不能用来做什么。</p>

<p>接下来首先会查看 IP 包的结构，然后简要地介绍 （Linux）内核的一些功能，然后进入正
题，介绍一种最常见的 NAT 应用场景，即，通过路由器（本例中为一台支持 iptables 的
Linux 机器）将私有子网连接到互联网。</p>

<p>再后面，我会介绍几种其他的可能性，例如重定向，或者如何使用代理（proxy）绕过防火
墙。但是，我不能保证这些解决方案是最智能、最强大或者设计最精巧的，读者应该
仅将它们视为展示 NAT 功能的一些示例方案（proof of concept）。</p>

<h2 id="2-网络内的数据包">2 网络内的数据包</h2>

<p>本节只讨论基于 TCP 和 UDP 协议的 IP 包。</p>

<p>IP 包的介绍见 <a href="http://en.wikipedia.org/wiki/IPv4">IPv4 at Wikipedia</a>。本文将主要
用到其中的两个字段：源 IP 和目的 IP。</p>

<p>TCP 和 UDP 是传输层协议，介绍分别见:</p>

<ol>
  <li><a href="http://en.wikipedia.org/wiki/Transmission_Control_Protocol">TCP at Wikipedia</a></li>
  <li><a href="http://en.wikipedia.org/wiki/User_Datagram_Protocol">UDP at Wikipedia</a></li>
</ol>

<p>传输层会用到端口号，本文为简单起见，认为每个（网络）进程进行有独立的端口号，例如
，HTTP 服务运行在 80 端口， SSH 服务运行在 22 端口。</p>

<p>一个 IP 地址加一个传输层端口号定义一个 socket。socket 是唯一的，一个客户端 socket
和一个服务端 socket 定义一个连接（connection），一端发送的数据，另一端就会接收到
。
例如，socket <code class="highlighter-rouge">123.123.123.123:65432</code> 和 socket <code class="highlighter-rouge">112.112.112.112:80</code> 建立的一个连
接，可能是 <code class="highlighter-rouge">123.123.123.123</code> 这台机器上的浏览器正在访问位于 <code class="highlighter-rouge">112.112.112.112</code> 上
面的HTTP 服务。</p>

<p>服务端程序一般使用标准的端口号，称为“well known ports”（公认的端口号），见 <a href="http://www.iana.org/assignments/port-numbers">well
known ports at IANA</a> 或<a href="http://en.wikipedia.org/wiki/Well_known_ports">well known
ports at Wikipedia</a>。客户端程序使
用临时端口号，一般从 1023 往上增加，选择一个可用的。</p>

<h2 id="3-linux-和-netfilter">3 Linux 和 Netfilter</h2>

<p>Linux 内核中有一个数据包过滤框架（packet filter framework），叫做 <strong>netfilter</strong>（
项目地址 <a href="netfilter.org">netfilter.org</a>）。这个框架使得 Linux 机器可以像路由器一
样工作。接下来我们将使用一个命令行工具 iptables 来创建复杂的规则，用于修改和过滤
数据包。毫无意外，和 NAT 相关的最重要的规则，都在 <code class="highlighter-rouge">nat</code>
这个（iptables）table 里。这个表有三个预置的chain：<code class="highlighter-rouge">PRETOUTING</code>, <code class="highlighter-rouge">OUTPUT</code> 和
<code class="highlighter-rouge">POSTROUTING</code>。</p>

<p align="center"><img src="/assets/img/nat-zh/nat-chains.gif" width="80%" height="80%" /></p>

<p><code class="highlighter-rouge">PREROUTING</code> 和 <code class="highlighter-rouge">POSTROUTING</code> 是最重要的 chain。如名字所示，<code class="highlighter-rouge">PRETOUTING</code> chain负
责处理刚刚到达网络接口的数据包，这时还没有做路由判断，因此还不知道这个包是发往本
机（local），还是网络内的其他主机。包经过 <code class="highlighter-rouge">PRETOUTING</code> chain 之后，将进行路由判
断。如果目的是本机，那接下来的过程将不涉及 NAT；如果目的是网络内的其他机器，那包
将会被转发到那台机器，前提是这台机器配置了允许转发。</p>

<p>在转发包离开本机之前，它会经过 <code class="highlighter-rouge">POSTROUTING</code> chain。对于本机生成的包，这里还有一
点不同：它会先经过 <code class="highlighter-rouge">OUTPUT</code> chain，然后再经过 <code class="highlighter-rouge">POSTROUTING</code> chain。</p>

<p>要使用 NAT，我们首先需要配置机器。下面的例子中，<code class="highlighter-rouge">#</code> 开头的是注释，<code class="highlighter-rouge">$&gt;</code> 开头的是命
令。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># IMPORTANT: Activate IP-forwarding in the kernel!</span>

<span class="c"># Disabled by default!</span>
<span class="nv">$&gt;</span> <span class="nb">echo</span> <span class="s2">"1"</span> <span class="o">&gt;</span> /proc/sys/net/ipv4/ip_forward

<span class="c"># Load various modules. Usually they are already loaded </span>
<span class="c"># (especially for newer kernels), in that case </span>
<span class="c"># the following commands are not needed.</span>
 
<span class="c"># Load iptables module:</span>
<span class="nv">$&gt;</span> modprobe ip_tables

<span class="c"># activate connection tracking</span>
<span class="c"># (connection's status are taken into account)</span>
<span class="nv">$&gt;</span> modprobe ip_conntrack

<span class="c"># Special features for IRC:</span>
<span class="nv">$&gt;</span> modprobe ip_conntrack_irc

<span class="c"># Special features for FTP:</span>
<span class="nv">$&gt;</span> modprobe ip_conntrack_ftp
</code></pre></div></div>

<p>以上配置应该足够了。如果遇到错误，可能是因为你的内核在编译时没有指定路由相关的选
项，请参考<a href="http://www.comptechdoc.org/os/linux/usersguide/linux_ugipmasq.html">这里</a>。</p>

<h2 id="4-例子将私有网络通过-nat-连接到互联网">4 例子：将私有网络通过 NAT 连接到互联网</h2>

<p>我们知道了 IP 包的结构，也知道了在 Linux 中如何操控数据包，因此接下来就可以应
用它了。NAT 最广泛的使用场景应该就是：<strong>一个私有子网的所有机器共享一个因特网连接</strong>。
接下来我们就从这个例子开始。</p>

<h3 id="41-类比地主和租户的信件收发">4.1 类比：地主和租户的信件收发</h3>

<p>我们用一个形象的例子做类比，以更容易理解 NAT。</p>

<p><strong>考虑如下场景：</strong></p>

<p>有一个地主，他的几个租户，和若干个邮递员。</p>

<p>地主有几个信箱可以收发信件，但租户没有，因此，所有直接寄给租户的信件将被邮递员直
接丢弃。但是，租户可以将他们的信件交给地主，地主会将这些信件送到邮局。那么问题是
：<strong>租户如何参与收发信件呢？</strong></p>

<p>一种解决方案是：</p>

<p>地主将不同租户的信件放到他自己不同的信箱，并将信件上<strong>租户的地址</strong>（某种意义上说
是无效地址，因为这个地址的信件会被邮递员直接丢弃）换成<strong>自己的某个信箱的地址</strong>
。因此，回信也会被邮递员放到地主的相应邮箱，地主可以轻松地判断信件属于哪个
租户并转交给他们（转交之前地主会将自己的地址再修改回租户的地址，因此租户不会发现
信件地址被修改过）。这种方式从某种意义上说是最优的，因为它对租户来说完全透明，他
们完全意识不到邮递员是无法处理直接寄给租户的信件的。</p>

<h3 id="42-从租户问题到计算机世界">4.2 从租户问题到计算机世界</h3>

<p>NAT 的原理和以上租户问题很相似：</p>

<ul>
  <li><strong>租户</strong>对应<strong>本地子网内的 IP 地址</strong>，不同租户（在 NAT 路由器上）由不同端口号（port）区分</li>
  <li><strong>地主</strong>对应<strong>NAT 路由器</strong></li>
  <li><strong>信件接收方</strong>对应<strong>互联网上的任意主机</strong></li>
</ul>

<p>一个 socket 是一个 IP 地址加一个 port。</p>

<p>租户的通信过程：</p>

<ol>
  <li>租户将信件放到地主的办公室</li>
  <li>地主将<strong>发送地址</strong>（此时为租户地址）改成他自己的某个邮箱地址</li>
  <li>地主收到回信时，将接收地址（此时为自己的某个邮箱地址）改成对应租户的地址</li>
</ol>

<p>本地网络的情形和这个过程很类似：</p>

<ol>
  <li>子网内的所有主机（客户端）通过 socket 将数据包发送到一个
特定路由器（通过将路由器地址设置为所有机器的网关来实现，数据会通过以太网
或其他底层协议传输）</li>
  <li>路由器将发送方的 socket 替换为自己的一个（还未使用的）socket</li>
  <li>这个 socket 收到的数据，路由器将 socket 地址修改为对应的客户端 socket，并转
发给它</li>
</ol>

<p>我们假设客户端的网关设置是正确的，那剩下的就是如何配置路由器了。</p>

<p>幸运的是，netfilter
框架会对设置的每条一条（出向或入向）规则，自动设置它的反向规则，因此我们只需要设
置一个方向的规则即可。选择哪个方向来设置规则？通常是选择不确定性小的一个方向。
例如，“替换所有从本地网络发出的数据包的地址”比“如果客户端发送过一些东西给服务端
，那将服务端发送的数据进行某种方式的修改”要简单的多。</p>

<h3 id="43-如何设置规则">4.3 如何设置规则</h3>

<p>我们希望实现的是：<strong>从本地网络发出的、目的是因特网的包，将发送方地址修改为路由器
的地址。</strong></p>

<p>接下来假设路由器的本地网络走 <code class="highlighter-rouge">eth0</code> 端口，到因特网的网络走 <code class="highlighter-rouge">eth1</code> 端口。那么<strong>如
下命令就能完成我们期望的功能</strong>：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Connect a LAN to the internet</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-o</span> eth1 <span class="nt">-j</span> MASQUERADE
</code></pre></div></div>

<p>解释：</p>

<ul>
  <li><code class="highlighter-rouge">iptables</code> - 配置内核的工具</li>
  <li><code class="highlighter-rouge">-t nat</code> - 指定对名为 <code class="highlighter-rouge">nat</code> 的 iptables table 配置 NAT 规则</li>
  <li><code class="highlighter-rouge">-A POSTROUTING</code> - 追加（A: Append）规则到 iptables 的 <code class="highlighter-rouge">POSTROUTING</code> chain</li>
  <li><code class="highlighter-rouge">-o eth1</code> - 指定只对从 <code class="highlighter-rouge">eth1</code> <strong>发出</strong>的数据包做操作（o: output）</li>
  <li><code class="highlighter-rouge">-j MASQUERADE</code> - 规则匹配成功后的动作是 <strong>masquerade</strong> （伪装）数据包，例如将
源地址修改为路由器地址</li>
</ul>

<p>另外需要说明的是，（除了客户端过来的包，）路由器自己的包也会涉及以上处理逻辑，因
为它们也经过<code class="highlighter-rouge">POSTROUTING</code> chain（见上面的图）。然而，因为路由器为客户端做 socket
(IP+Port) 转换的时候，会从它的未使用端口中挑选，因此它自身的包所使用的 port 与做
NAT的 port 肯定是不同的。因此，虽然它自身的包也会经过以上规则，但并不会被修改。</p>

<p>网络接口可以为任意类型，例如 ISDN 和 SDL 接口也是可以的（通常是 <code class="highlighter-rouge">ppp0</code> 或者
<code class="highlighter-rouge">ippp0</code>）。可以通过 <code class="highlighter-rouge">ifconfig</code> 查看所有（active）的接口：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Display available network interfaces</span>
<span class="nv">$&gt;</span> ifconfig
</code></pre></div></div>

<h3 id="44-nat-的不足">4.4 NAT 的不足</h3>

<p>现在，本地计算机可以访问因特网，但反过来，我们看看因特网上的机器访问本地机器会是
什么情况。</p>

<p>因特网上的机器要和本地机器建立连接的话，它唯一能利用的信息就是用路由器的 IP 地址
加一个端口号。大部分情况下，这个端口都是没有被使用的，因此过来的包会被拒绝。即使
运气比较好，这个端口是路由器做 NAT 的一个端口，包仍然很可能会被拒绝，因为这个端
口已经和因特网上的其他主机建立连接了。</p>

<p><strong>因此，从因特网上的机器向本地机器建立连接几乎是不可能的。</strong></p>

<p>对于常规服务，可以静态地将路由器的端口映射到本地服务，例如，将路由器的80端口收到
的包转发到本地机器的 HTTP 服务器。</p>

<h2 id="5-近距离查看-iptables">5 近距离查看 iptables</h2>

<p>有了以上基础后，我们来详细查看 iptables 的功能。命令帮助：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Abstract structure of an iptables instruction:</span>
iptables <span class="o">[</span><span class="nt">-t</span> table] <span class="nb">command</span> <span class="o">[</span>match pattern] <span class="o">[</span>action]
</code></pre></div></div>

<p>对于 NAT，必须要选择 <code class="highlighter-rouge">nat</code> table。</p>

<h3 id="51-选择-table">5.1 选择 table</h3>

<p>接下来的命令都会选择 <code class="highlighter-rouge">nat</code> table：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Choosing the nat-table</span>
<span class="c"># (further arguments abbreviated by [...])</span>
iptables <span class="nt">-t</span> nat <span class="o">[</span>...]
</code></pre></div></div>

<p><code class="highlighter-rouge">mangle</code> 和 <code class="highlighter-rouge">filter</code> table 和 NAT 无关，因此本文不介绍。因为 <strong>默认的 table 是
<code class="highlighter-rouge">filter</code> table，因此我们接下来每次都要指定 <code class="highlighter-rouge">-t nat</code></strong>。</p>

<h3 id="52-几个重要命令">5.2 几个重要命令</h3>

<p>最重要的几个命令：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In the following "chain" represents</span>
<span class="c"># one of the chains PREROUTING, OUTPUT and POSTROUTING</span>

<span class="c"># add a rule:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> chain <span class="o">[</span>...]

<span class="c"># list rules:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-L</span>

<span class="c"># remove user-defined chain with index 'myindex':</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-D</span> chain myindex

<span class="c"># Remove all rules in chain 'chain':</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-F</span> chain
</code></pre></div></div>

<p>完整 iptables 命令可以查看 man page：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># manual pages of iptables</span>
<span class="nv">$&gt;</span> man iptables
</code></pre></div></div>

<p>按 <code class="highlighter-rouge">q</code> 退出帮助。</p>

<h3 id="53-选择匹配模式pattern">5.3 选择匹配模式（pattern）</h3>

<p>要对特定包进行处理需要指定匹配模式。如下是几个重要的例子，完整模式信息请参阅
iptables man page。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># actions to be taken on matched packets</span>
<span class="c"># will be abbreviated by '[...]'.</span>
<span class="c"># Depending on the match pattern the appropriate chain is selected.</span>

<span class="c"># TCP packets from 192.168.1.2:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-p</span> tcp <span class="nt">-s</span> 192.168.1.2 <span class="o">[</span>...]

<span class="c"># UDP packets to 192.168.1.2:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-p</span> udp <span class="nt">-d</span> 192.168.1.2 <span class="o">[</span>...]

<span class="c"># all packets from 192.168.x.x arriving at eth0:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-s</span> 192.168.0.0/16 <span class="nt">-i</span> eth0 <span class="o">[</span>...]

<span class="c"># all packets except TCP packets and except packets from 192.168.1.2:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-p</span> <span class="o">!</span> tcp <span class="nt">-s</span> <span class="o">!</span> 192.168.1.2 <span class="o">[</span>...]

<span class="c"># packets leaving at eth1:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-o</span> eth1 <span class="o">[</span>...]

<span class="c"># TCP packets from 192.168.1.2, port 12345 to 12356</span>
<span class="c"># to 123.123.123.123, Port 22</span>
<span class="c"># (a backslash indicates contination at the next line)</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-p</span> tcp <span class="nt">-s</span> 192.168.1.2 <span class="se">\</span>
   <span class="nt">--sport</span> 12345:12356 <span class="nt">-d</span> 123.123.123.123 <span class="nt">--dport</span> 22 <span class="o">[</span>...]
</code></pre></div></div>

<p>大部分选项都有长短两种格式，例如 <code class="highlighter-rouge">--source</code> 和 <code class="highlighter-rouge">-s</code>，长格式写起来麻烦，但更易
阅读。</p>

<h3 id="54-匹配后的动作">5.4 匹配后的动作</h3>

<p>至此，我们已经可以指定匹配模式来过滤包了，接下来就是选择合适的动作。对于 <code class="highlighter-rouge">nat</code>
table，有如下几种动作：<code class="highlighter-rouge">SNAT</code>, <code class="highlighter-rouge">MASQUERADE</code>, <code class="highlighter-rouge">DNAT</code>, <code class="highlighter-rouge">REDIRECT</code>，都需要通过 <code class="highlighter-rouge">-j</code>
指定。它们的格式如下（表示的意思将在下一节介绍）：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In the following the table selection, the command and the match pattern</span>
<span class="c"># will be abbreviated using [...]</span>

<span class="c"># Source-NAT: Change sender to 123.123.123.123</span>
<span class="nv">$&gt;</span> iptables <span class="o">[</span>...] <span class="nt">-j</span> SNAT <span class="nt">--to-source</span> 123.123.123.123

<span class="c"># Mask: Change sender to outgoing network interface</span>
<span class="nv">$&gt;</span> iptables <span class="o">[</span>...] <span class="nt">-j</span> MASQUERADE

<span class="c"># Destination-NAT: Change receipient to 123.123.123.123, port 22</span>
<span class="nv">$&gt;</span> iptables <span class="o">[</span>...] <span class="nt">-j</span> DNAT <span class="nt">--to-destination</span> 123.123.123.123:22

<span class="c"># Redirect to local port 8080</span>
<span class="nv">$&gt;</span> iptables <span class="o">[</span>...] <span class="nt">-j</span> REDIRECT <span class="nt">--to-ports</span> 8080
</code></pre></div></div>

<h2 id="6-几种-iptables-动作">6 几种 iptables 动作</h2>

<p>详细解释一下四种动作。</p>

<h3 id="61-snat---修改源-ip-为固定新-ip-静态">6.1 SNAT - 修改源 IP 为固定新 IP （静态）</h3>

<p>前面的将本地私有网络连接到因特网的例子中，我们已经使用了 Source NAT（SNAT
）。如名字所暗示，发送方的地址会被静态地修改。</p>

<p>在例子中我们选择 <code class="highlighter-rouge">MASQUERADE</code> 的原因在于：<strong>对于 SNAT，必须显式指定转换后的 IP</strong>。
如果路由器配置的是静态 IP 地址，那 SNAT 是最合适的选择，因为它比 <code class="highlighter-rouge">MASQUERADE</code> 更
快，后者对每个包都需要检查指定的输出端口上配置的 IP 地址。</p>

<p><strong>因为 SNAT 只对离开路由器的包有意义，因此它只用在 <code class="highlighter-rouge">POSTROUTING</code> chain 中。</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Options for SNAT (abstract of manual page)</span>
<span class="nt">--to-source</span> &lt;ipaddr&gt;[-&lt;ipaddr&gt;][:port-port]
</code></pre></div></div>

<h3 id="62-masquerade---修改源-ip-为动态新-ip动态获取网络接口-ip">6.2 MASQUERADE - 修改源 IP 为动态新 IP（动态获取网络接口 IP）</h3>

<p>和 <code class="highlighter-rouge">SNAT</code> 类似，但是对每个包都会动态获取指定输出接口（网卡）的 IP，因此如果接口
的 IP 地址发送了变化，<code class="highlighter-rouge">MASQUERADE</code> 规则不受影响，可以正常工作；而对于 <code class="highlighter-rouge">SNAT</code> 
就必须重新调整规则。</p>

<p>和 <code class="highlighter-rouge">SNAT</code> 一样，<code class="highlighter-rouge">MASQUERADE</code> 只对 <code class="highlighter-rouge">POSTROUTING</code> chain 有意义。但和 <code class="highlighter-rouge">SNAT</code> 不同，
<code class="highlighter-rouge">MASQUERADE</code> 不支持更详细的配置项了。</p>

<h3 id="63-dnat---修改目的-ip">6.3 DNAT - 修改目的 IP</h3>

<p>如果想修改包的目的 IP 地址，那需要使用 Destination NAT（DNAT）。</p>

<p>DNAT 可以用于运行在防火墙后面的服务器。</p>

<p>显然，接收端修改<strong>必须在做路由决策之前，因此 DNAT 适用于 <code class="highlighter-rouge">PRETOUTING</code> 和
<code class="highlighter-rouge">OUTPUT</code> （本地生成的包）chain</strong>。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Options for DNAT (abstract of manual page)</span>
<span class="nt">--to-destination</span> &lt;ipaddr&gt;[-&lt;ipaddr&gt;][:port-port] 
</code></pre></div></div>

<h3 id="63-redirect---将包重定向到本机另一个端口">6.3 REDIRECT - 将包重定向到本机另一个端口</h3>

<p>REDIRECT 是 DNAT 的一个特殊场景。包被重定向到路由器的另一个本地端口，可以实现，
例如透明代理的功能。和 DNAT 一样，REDIRECT 适用于 <code class="highlighter-rouge">PRETOUTING</code> 和 <code class="highlighter-rouge">OUTPUT</code> chain
。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Options for REDIRECT (abstract of manual page)</span>
<span class="nt">--to-ports</span> &lt;port&gt;[-&lt;port&gt;] 
</code></pre></div></div>

<h2 id="7-nat-应用-applications">7 NAT 应用 (Applications)</h2>

<p>本文第一个例子（将本地网络连接到因特网）的晦涩（cryptic）指令可能让你有些困惑。
之后我们陆续给了一些命令参数的解释，读者应该比之前理解更清楚了一些。问题可能从“
人们怎么写出这么晦涩的指令的” 变成了 “好的，我该如何使用这些晦涩的指令呢？”本章
将给出一些如何使用 NAT 的例子。应用范围并没有限制，但我将尽力涵盖最常见的一些场
景。</p>

<h3 id="71-透明代理">7.1 透明代理</h3>

<p>假设我们有一个本地网络，通过 NAT 连接到因特网。我们需要在路由器的 8080 端口运行
一个HTTP 代理，处理本地网络 HTTP 流量。</p>

<p>首先想到的解决方案是：让每个用户设置他们的浏览器使用代理服务器，然后禁止所有 80
端口的出流量。对于很小的网络，这种方式可能让人满意，但无法扩展到很大的网络，因为
这种方式需要对每个客户端进行配置。（也失去了“透明代理”的意义）。</p>

<p align="center"><img src="/assets/img/nat-zh/transparent-proxy-en.gif" width="80%" height="80%" /></p>

<p>使用 NAT，我们有另一种可能：所有从 80 端口进来的流量，重定向到 8080 端口。相应
的命令：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Transparent proxying:</span>
<span class="c"># (local net at eth0, proxy server at port 8080)</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-i</span> eth0 <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="se">\</span>
   <span class="nt">-j</span> REDIRECT <span class="nt">--to-ports</span> 8080 
</code></pre></div></div>

<p>当然，8080 端口要有 HTTP 代理运行。另外，你的服务器可能做一些特殊配置（甚至特殊
编译）才能支持透明代理。</p>

<p>透明代理的缺点是 CPU load 会升高（尤其是大型网络），对太新或太旧的浏览器可能有兼
容性问题。</p>

<h3 id="72-绕过防火墙">7.2 绕过防火墙</h3>

<p>在继续本文之前，我首先要发出警告：</p>

<p><strong>每位读者在使用以下提供的技术之前，都需要确认这些步骤是否会破坏你们的现有环境！
使用如下命令带来的风险是读者自己的，对不当使用以下命令和技术带来的损坏，我不负
任何责任！</strong></p>

<p>你可能意想不到，NAT 在这种场景下可以派上用场。</p>

<p>我们假设路由器只有少量端口可以被本地网络访问。</p>

<p>首先要找到这些已经被打开的（open）端口。一个的常用工具是
<a href="http://insecure.org/nmap/">nmap</a>（请只扫描你自己的机器，扫描未知的机器会被认为
是入侵行为的前奏）。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Scan a machine:</span>
<span class="c"># (Replace www.example.com by an appropriate machine)</span>
<span class="nv">$&gt;</span> nmap www.example.com
</code></pre></div></div>

<p>以上命令会扫描出很多端口，其中大部分处于 “closed” 状态（该端口上没有服务），另
外有一部分处于 “filtered” 状态（该端口上没有连接），可能有一些处于 “open” 状态（
服务正在该端口上运行）。我们假设 5000 以下的端口除了 80 都处于 closed 状态，但是
5000 以上的端口有
可达的。</p>

<p>为了实现可以连接任意外网机器的 5000 以下的任意端口，需要一个位于防火墙之前的机器
（称为跳板机，位置没有关系，只要网络可达，并且它自己没有被防火墙限制），它要能被
访问，并且支持NAT （iptables）。假设这台机器 IP 为 <code class="highlighter-rouge">111.111.111.111</code>。</p>

<h4 id="721-配置内网机器可以-ssh-到跳板机">7.2.1 配置内网机器可以 SSH 到跳板机</h4>

<p>首先需要 SSH 登录到 <code class="highlighter-rouge">111.111.111.111</code>（由于防火墙限制 5000 以下端口，SSH 端口默
认是22，因此需要在防火墙外面找机器才能登录）。然后在 <code class="highlighter-rouge">111.111.111.111</code> 上执行：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Redirect SSH from port 5000 to port 22:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-p</span> tcp <span class="nt">--dport</span> 5000 <span class="nt">-j</span> REDIRECT <span class="nt">--to-ports</span> 22
</code></pre></div></div>

<p>这个命令做的事情就是，将 5000 端口 进来的流量重定向到本机的 22 端口（SSH）。</p>

<p>然后，我们在防火墙内的机器上，就可以通过 5000 端口用 SSH 访问工作站了，工作站会
将请求转向 <code class="highlighter-rouge">111.111.111.111</code> 的 <code class="highlighter-rouge">22</code> 端口。</p>

<p>或者，你也可以配置 <code class="highlighter-rouge">111.111.111.111</code> 的 SSH 进程直接运行在5000 端口，这样就不需
要以上 iptables 规则了。</p>

<h4 id="722-通过跳板机从内网连接到公网举例邮件服务器-pop3">7.2.2 通过跳板机从内网连接到公网举例：邮件服务器 POP3</h4>

<p>现在，你可以在跳板机 <code class="highlighter-rouge">111.111.111.111</code> 上配置连接其他机器或服务（运行在其他端口
）的NAT 规则来。</p>

<p>例如，通过跳板机的 5001 端口连接机器 <code class="highlighter-rouge">123.123.123.123</code> 的 110 （POP3）端口，执行：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># redirect port 5001 to port 110 (POP3) at 123.123.123.123:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-p</span> tcp <span class="nt">--dport</span> 5001 <span class="se">\</span>
   <span class="nt">-j</span> DNAT <span class="nt">--to-destination</span> 123.123.123.123:110
   
<span class="c"># Change sender to redirecting machine:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> POSTROUTING <span class="nt">-p</span> tcp <span class="nt">--dport</span> 110 <span class="se">\</span>
   <span class="nt">-j</span> MASQUERADE
</code></pre></div></div>

<p align="center"><img src="/assets/img/nat-zh/port110-en.gif" width="60%" height="60%" /></p>

<p>这里用的是 <code class="highlighter-rouge">MASQUERADE</code>，但用 <code class="highlighter-rouge">SNAT</code> 也是可以的（<code class="highlighter-rouge">-j SNAT --to-source
111.111.111.111</code>）。</p>

<p>用同样的方式，我们可以（从内网）连接到（外网机器的）其他端口，只要跳板机上的可用
端口足够多。即使是安全连接（例如 IMAPS）也可以这样操作，但需要忽略安全证书的警告
（只要我们知道自己在做什么）。对于上面的 POP3 例子，你还需要配置你的邮件客户端，
将服务器地址设置为 <code class="highlighter-rouge">111.111.111.111</code>，端口为 <code class="highlighter-rouge">5001</code>。</p>

<h4 id="723-通过跳板机绕过-http-监控">7.2.3 通过跳板机绕过 HTTP 监控</h4>

<p>假设网络供应商为80端口的所有连接设置了代理（例如，透明代理），然后监控所有的网络
流量（内容），我们使用 NAT 可以绕过它。</p>

<p>和上面类似，在跳板机上寻找一个可用端口，例如 5002，做透明代理。</p>

<p>然后，在你自己的（内网）机器上，执行：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># redirect http-Traffic going to Port 80 to 111.111.111.111:5002:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="se">\</span>
   <span class="nt">-j</span> DNAT <span class="nt">--to-destination</span> 111.111.111.111:5002
</code></pre></div></div>

<p>这样就成功绕过了供应商的代理（我们使用透明代理绕过了供应商的透明代理！）。</p>

<p>或者，不需要 iptables 规则，你可以设置浏览器的默认端口是 5002，但是这可能有一些
潜在的问题。</p>

<p>总结本节的透明代理方案步骤：</p>

<ol>
  <li>首先找到找到一个可用端口，可以让内网机器和跳板机建立 SSH 连接</li>
  <li>静态地将可用端口重定向到期望的地址（大部分情况下都是 HTTP 服务）</li>
</ol>

<p>如果想实现动态重定向，那两个 TCP 端口（其中一个用于 SSH）和一个 UDP 端口足够了，
据此可以实现从内网机器连接到任意外网机器的任意端口，唯一的不足是每次只能有一个连
接（每种协议）。</p>

<h3 id="73-通过-nat-从外网访问内网服务">7.3 通过 NAT 从外网访问内网服务</h3>

<p>运行在 NAT 路由器后面的内网服务器，默认是不能被外部网络直接访问的。例如，假设我
们有一个 HTTP 服务运行在内网机器 <code class="highlighter-rouge">192.168.1.2</code>，NAT 路由器的地址是 <code class="highlighter-rouge">192.168.1.1</code>
，并通过另一张有公网 IP <code class="highlighter-rouge">123.123.123.123</code> 的网卡连接到了外部网络。</p>

<p>要使得外网机器可以访问 <code class="highlighter-rouge">192.168.1.2</code> 的服务，需要执行：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># redirect http traffic to 192.168.1.2:</span>
<span class="nv">$&gt;</span> iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-p</span> tcp <span class="nt">-i</span> eth1 <span class="nt">--dport</span> 80 <span class="nt">-j</span> DNAT <span class="nt">--to</span> 192.168.1.2
</code></pre></div></div>

<p>然后，就可以通过公网 IP <code class="highlighter-rouge">123.123.123.123</code> 的 80 端口访问 <code class="highlighter-rouge">192.168.1.2</code> 的 HTTP
服务了。</p>

<h2 id="8-相关文章">8 相关文章</h2>

<p>类似的文章：</p>

<ol>
  <li><a href="http://iptables-tutorial.frozentux.net/iptables-tutorial.html">http://iptables-tutorial.frozentux.net/iptables-tutorial.html</a>, 非常详细的关于 iptables 的文章</li>
  <li><a href="http://www.faqs.org/docs/Linux-mini/TransparentProxy.html">http://www.faqs.org/docs/Linux-mini/TransparentProxy.html</a>, 关于透明代理更深入的介绍</li>
  <li><a href="http://www.barryodonovan.com/publications/lg/108/">http://www.barryodonovan.com/publications/lg/108/</a>, netfilter extension 来实现更多的功能</li>
</ol>

<h2 id="9-结束语致谢及其他">9 结束语，致谢及其他</h2>

<p>netfilter 框架非常强大，而且一旦熟悉其语法后，配置还是比较简单的。基于
iptables/netfilter
可以完成很多功能，虽然一些命令看起来可能比较晦涩，但拿几个例子稍加训练之后，你就
会发现它们都符合特定的模式，可以用于快速简单的管理。</p>

<p>感谢每一位能读到这里的耐心读者 :-) 另外我还要感谢我的运行 SUSE 10.1的笔记本，没
有在写作本文的时候挂掉。</p>

<p>我的母语不是英语，因此如果读者能指出本文措辞语句的一些可改进之处，我将非常高兴。
<a href="https://www.karlrupp.net/en/computer/nat_tutorial">这里</a>
（见原文，这里不贴是防止给原作者带去潜在的垃圾邮件，事实上原作者贴的是图片而不是
文本，也应该有此考虑）是我的联系邮箱。</p>


  <!-- POST NAVIGATION -->
  <div class="postNav clearfix">
     
      <a class="prev" href="/blog/cilium-code-walk-through-create-network/"><span>&laquo;&nbsp;Cilium Code Walk Through: CNI Create Network</span>
      
    </a>
      
      
      <a class="next" href="/blog/deep-dive-into-iptables-and-netfilter-arch-zh/"><span>[译] 深入理解 iptables 和 netfilter 架构&nbsp;&raquo;</span>
       
      </a>
     
  </div>
</div>


         

      </div>
   </div><!-- end .content -->

   <div class="footer">
   <div class="container">
      <p class="copy">&copy; 2016-2019
      <a href="https://arthurchiao.github.io">Arthur Chiao</a>, Powered by
      <a href="http://jekyllrb.com">Jekyll </a>, Theme originated from
      <a href="https://github.com/brianmaierjr/long-haul"> Long Haul.</a>

      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span id="busuanzi_container_site_pv"> Site visits:
          <span id="busuanzi_value_site_pv"></span>, powered by<a href="http://busuanzi.ibruce.info/"> busuanzi</a>
      </span>

      </p>

      <div class="footer-links"> 
         <ul class="noList"> 
            
            <li><a href="https://www.facebook.com/profile.php?id=100014334455077">
                  <svg id="facebook-square" class="custom-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" style="height: 30px; width: 30px;"><circle class="outer-shape" cx="50" cy="50" r="48" style="opacity: 1;"></circle>
                  <path class="inner-shape" style="opacity: 1;" transform="translate(25,25) scale(0.5)" d="M82.667,1H17.335C8.351,1,1,8.351,1,17.336v65.329c0,8.99,7.351,16.335,16.334,16.335h65.332 C91.652,99.001,99,91.655,99,82.665V17.337C99,8.353,91.652,1.001,82.667,1L82.667,1z M84.318,50H68.375v42.875H50V50h-8.855V35.973 H50v-9.11c0-12.378,5.339-19.739,19.894-19.739h16.772V22.3H72.967c-4.066-0.007-4.57,2.12-4.57,6.078l-0.023,7.594H86.75 l-2.431,14.027V50z"></path>
                  </svg>
            </a></li>
            
            
            <li><a href="https://linkedin.com/in/yanan-zhao-7691317b?trk=hp-identity-photo">
                  <svg id="linkedin" class="custom-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" style="height: 30px; width: 30px;"><circle class="outer-shape" cx="50" cy="50" r="48" style="opacity: 1;"></circle>
                  <path class="inner-shape" style="opacity: 1;" transform="translate(25,25) scale(0.5)" d="M99.001,19.428c-3.606,1.608-7.48,2.695-11.547,3.184c4.15-2.503,7.338-6.466,8.841-11.189 c-3.885,2.318-8.187,4-12.768,4.908c-3.667-3.931-8.893-6.387-14.676-6.387c-11.104,0-20.107,9.054-20.107,20.223 c0,1.585,0.177,3.128,0.52,4.609c-16.71-0.845-31.525-8.895-41.442-21.131C6.092,16.633,5.1,20.107,5.1,23.813 c0,7.017,3.55,13.208,8.945,16.834c-3.296-0.104-6.397-1.014-9.106-2.529c-0.002,0.085-0.002,0.17-0.002,0.255 c0,9.799,6.931,17.972,16.129,19.831c-1.688,0.463-3.463,0.71-5.297,0.71c-1.296,0-2.555-0.127-3.783-0.363 c2.559,8.034,9.984,13.882,18.782,14.045c-6.881,5.424-15.551,8.657-24.971,8.657c-1.623,0-3.223-0.096-4.796-0.282 c8.898,5.738,19.467,9.087,30.82,9.087c36.982,0,57.206-30.817,57.206-57.543c0-0.877-0.02-1.748-0.059-2.617 C92.896,27.045,96.305,23.482,99.001,19.428z"></path>
                  </svg>
            </a></li>
            
            
            <li><a href="https://github.com/ArthurChiao">
                  <svg id="github" class="custom-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" style="height: 30px; width: 30px;"><circle class="outer-shape" cx="50" cy="50" r="48" style="opacity: 1;"></circle>
                  <path class="inner-shape" style="opacity: 1;" transform="translate(25,25) scale(0.5)" d="M50,1C22.938,1,1,22.938,1,50s21.938,49,49,49s49-21.938,49-49S77.062,1,50,1z M79.099,79.099 c-3.782,3.782-8.184,6.75-13.083,8.823c-1.245,0.526-2.509,0.989-3.79,1.387v-7.344c0-3.86-1.324-6.699-3.972-8.517 c1.659-0.16,3.182-0.383,4.57-0.67c1.388-0.287,2.855-0.702,4.402-1.245c1.547-0.543,2.935-1.189,4.163-1.938 c1.228-0.75,2.409-1.723,3.541-2.919s2.082-2.552,2.847-4.067s1.372-3.334,1.818-5.455c0.446-2.121,0.67-4.458,0.67-7.01 c0-4.945-1.611-9.155-4.833-12.633c1.467-3.828,1.308-7.991-0.478-12.489l-1.197-0.143c-0.829-0.096-2.321,0.255-4.474,1.053 c-2.153,0.798-4.57,2.105-7.249,3.924c-3.797-1.053-7.736-1.579-11.82-1.579c-4.115,0-8.039,0.526-11.772,1.579 c-1.69-1.149-3.294-2.097-4.809-2.847c-1.515-0.75-2.727-1.26-3.637-1.532c-0.909-0.271-1.754-0.439-2.536-0.503 c-0.782-0.064-1.284-0.079-1.507-0.048c-0.223,0.031-0.383,0.064-0.478,0.096c-1.787,4.53-1.946,8.694-0.478,12.489 c-3.222,3.477-4.833,7.688-4.833,12.633c0,2.552,0.223,4.889,0.67,7.01c0.447,2.121,1.053,3.94,1.818,5.455 c0.765,1.515,1.715,2.871,2.847,4.067s2.313,2.169,3.541,2.919c1.228,0.751,2.616,1.396,4.163,1.938 c1.547,0.543,3.014,0.957,4.402,1.245c1.388,0.287,2.911,0.511,4.57,0.67c-2.616,1.787-3.924,4.626-3.924,8.517v7.487 c-1.445-0.43-2.869-0.938-4.268-1.53c-4.899-2.073-9.301-5.041-13.083-8.823c-3.782-3.782-6.75-8.184-8.823-13.083 C9.934,60.948,8.847,55.56,8.847,50s1.087-10.948,3.231-16.016c2.073-4.899,5.041-9.301,8.823-13.083s8.184-6.75,13.083-8.823 C39.052,9.934,44.44,8.847,50,8.847s10.948,1.087,16.016,3.231c4.9,2.073,9.301,5.041,13.083,8.823 c3.782,3.782,6.75,8.184,8.823,13.083c2.143,5.069,3.23,10.457,3.23,16.016s-1.087,10.948-3.231,16.016 C85.848,70.915,82.88,75.317,79.099,79.099L79.099,79.099z"></path>
                  </svg>
            </a></li>
             
            
            <li><a href="mailto:arthurchiao@hotmail.com">
                  <svg id="mail" class="custom-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" style="height: 30px; width: 30px;"><circle class="outer-shape" cx="50" cy="50" r="48" style="opacity: 1;"></circle>
                  <path class="inner-shape" style="opacity: 1;" transform="translate(25,25) scale(0.5)" d="M50,1C22.938,1,1,22.938,1,50s21.938,49,49,49s49-21.938,49-49S77.062,1,50,1z M25.5,25.5h49 c0.874,0,1.723,0.188,2.502,0.542L50,57.544L22.998,26.041C23.777,25.687,24.626,25.499,25.5,25.5L25.5,25.5z M19.375,68.375v-36.75 c0-0.128,0.005-0.256,0.014-0.383l17.96,20.953L19.587,69.958C19.448,69.447,19.376,68.916,19.375,68.375L19.375,68.375z M74.5,74.5 h-49c-0.541,0-1.072-0.073-1.583-0.212l17.429-17.429L50,66.956l8.653-10.096l17.429,17.429C75.572,74.427,75.041,74.5,74.5,74.5 L74.5,74.5z M80.625,68.375c0,0.541-0.073,1.072-0.211,1.583L62.652,52.195l17.96-20.953c0.008,0.127,0.014,0.255,0.014,0.383 L80.625,68.375L80.625,68.375z"></path>
                  </svg>
            </a></li>
            
         </ul>
      </div>
   </div>
</div><!-- end .footer -->

   <!-- Add jQuery and other scripts -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src=""><\/script>')</script>
<script src="/assets/js/dropcap.min.js"></script>
<script src="/assets/js/responsive-nav.min.js"></script>
<script src="/assets/js/scripts.js"></script>


</body>

</html>
